---
import Layout from "@/layouts/Layout.astro";
import TourDashboard from "@/components/TourDashboard";
import { OnboardingModal } from "@/components/OnboardingModal";
import { profileService } from "@/lib/services/profile.service";

const { user, supabase } = Astro.locals;
let onboardingCompleted = true; // Default to true for existing users or if fetch fails

if (user) {
  const { data: profile } = await profileService.getProfile(supabase, user.id);
  if (profile) {
    onboardingCompleted = profile.onboarding_completed;
  }
}
---

<Layout title="Dashboard">
  <TourDashboard client:load onboardingCompleted={onboardingCompleted} />
</Layout>
